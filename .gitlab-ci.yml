variables:
  DOCKER_TLS_CERTDIR: ''

stages:
  - deploy

.swpc-runner:
  tags:
    - aws
    - m4-large

default:
  tags:
    - TPEA90099186

deploy:
  stage: deploy
  image: docker:19.03.8
  services:
    - docker:19.03.8-dind
  only:
    refs:
      - tags
  before_script:
    - echo "'$SSOT_USER_TOKEN'" | docker login -u '$SSOT_USER_NAME' --password-stdin harbor.wistron.com
  script:
    # build dev
    - docker build --build-arg STAGE=dev -t harbor.wistron.com/k8sprdwhqecossot2021/eco-ssot-frontend:$CI_COMMIT_TAG-dev .
    - docker push harbor.wistron.com/k8sprdwhqecossot2021/eco-ssot-frontend:$CI_COMMIT_TAG-dev
    # build prd
    - docker build --build-arg STAGE=prod -t harbor.wistron.com/k8sprdwhqecossot2021/eco-ssot-frontend:$CI_COMMIT_TAG-prd .
    - docker push harbor.wistron.com/k8sprdwhqecossot2021/eco-ssot-frontend:$CI_COMMIT_TAG-prd
  cache: {}
  dependencies: []
