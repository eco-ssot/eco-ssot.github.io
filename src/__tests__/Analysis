import { waitFor } from '@testing-library/react';
import userEvent from '@testing-library/user-event';

import { renderWithProviders } from '../__mocks__/helpers';
import ElectricityAnalysisPage from '../pages/electricity/ElectricityAnalysisPage';
import WasteAnalysisPage from '../pages/waste/WasteAnalysisPage';
import WaterAnalysisPage from '../pages/water/WaterAnalysisPage';

describe('Electricity Analysis', () => {
  test('handles post electricity analysis response', async () => {
    const { getByText, getAllByRole, getByLabelText } = renderWithProviders(<ElectricityAnalysisPage />);
    await waitFor(() => expect(getByText(/14,677,385/)).toBeInTheDocument());
    await waitFor(() => expect(getByText(/1234 %/)).toBeInTheDocument());
    const button = getByText(/analysisPage:addDesc/);
    userEvent.click(button);
    const textBoxes = getAllByRole('textbox');
    textBoxes.forEach((textbox, i) => userEvent.type(textbox, `Hello World! ${i}`));
    const saveButton = getByLabelText('icon-button-check');
    userEvent.click(saveButton);
    await waitFor(() => expect(getByText(/Hello World! 0/)).toBeInTheDocument());
  });

  test('handles patch electricity analysis response', async () => {
    const { getByText, getAllByRole, getByLabelText, getAllByLabelText } = renderWithProviders(
      <ElectricityAnalysisPage />
    );

    await waitFor(() => expect(getByText(/14,677,385/)).toBeInTheDocument());
    await waitFor(() => expect(getByText(/1234 %/)).toBeInTheDocument());
    const editButton = getAllByLabelText('icon-button-pencil')[0];
    userEvent.click(editButton);
    const textBoxes = getAllByRole('textbox');
    textBoxes.forEach((textbox, i) => userEvent.type(textbox, `Hello World! ${i}`));
    const saveButton = getByLabelText('icon-button-check');
    userEvent.click(saveButton);
    await waitFor(() => expect(getByText(/Hello World! 0/)).toBeInTheDocument());
  });
});

describe('Water Analysis', () => {
  test('handles post water analysis response', async () => {
    const { getAllByRole, getByText, getByLabelText } = renderWithProviders(<WaterAnalysisPage />);
    await waitFor(() => expect(getByText(/221,384/)).toBeInTheDocument());
    await waitFor(() => expect(getByText(/1234 %/)).toBeInTheDocument());
    const button = getByText(/analysisPage:addDesc/);
    userEvent.click(button);
    const textBoxes = getAllByRole('textbox');
    textBoxes.forEach((textbox, i) => userEvent.type(textbox, `Hello World! ${i}`));
    const saveButton = getByLabelText('icon-button-check');
    userEvent.click(saveButton);
    await waitFor(() => expect(getByText(/Hello World! 0/)).toBeInTheDocument());
  });

  test('handles patch water analysis response', async () => {
    const { getByText, getAllByRole, getAllByLabelText, getByLabelText } = renderWithProviders(<WaterAnalysisPage />);
    await waitFor(() => expect(getByText(/221,384/)).toBeInTheDocument());
    await waitFor(() => expect(getByText(/1234 %/)).toBeInTheDocument());
    const editButton = getAllByLabelText('icon-button-pencil')[0];
    userEvent.click(editButton);
    const textBoxes = getAllByRole('textbox');
    textBoxes.forEach((textbox, i) => userEvent.type(textbox, `Hello World! ${i}`));
    const saveButton = getByLabelText('icon-button-check');
    userEvent.click(saveButton);
    await waitFor(() => expect(getByText(/Hello World! 0/)).toBeInTheDocument());
  });
});

describe('Waste Analysis', () => {
  test('handles post waste analysis response', async () => {
    const { getAllByRole, getByText, getByLabelText } = renderWithProviders(<WasteAnalysisPage />);
    await waitFor(() => expect(getByText(/1,481.51/)).toBeInTheDocument());
    await waitFor(() => expect(getByText(/1234 %/)).toBeInTheDocument());
    const button = getByText(/analysisPage:addDesc/);
    userEvent.click(button);
    const textBoxes = getAllByRole('textbox');
    textBoxes.forEach((textbox, i) => userEvent.type(textbox, `Hello World! ${i}`));
    const saveButton = getByLabelText('icon-button-check');
    userEvent.click(saveButton);
    await waitFor(() => expect(getByText(/Hello World! 0/)).toBeInTheDocument());
  });

  test('handles patch waste analysis response', async () => {
    const { getByText, getAllByRole, getAllByLabelText, getByLabelText } = renderWithProviders(<WasteAnalysisPage />);
    await waitFor(() => expect(getByText(/1,481.51/)).toBeInTheDocument());
    await waitFor(() => expect(getByText(/1234 %/)).toBeInTheDocument());
    const editButton = getAllByLabelText('icon-button-pencil')[0];
    userEvent.click(editButton);
    const textBoxes = getAllByRole('textbox');
    textBoxes.forEach((textbox, i) => userEvent.type(textbox, `Hello World! ${i}`));
    const saveButton = getByLabelText('icon-button-check');
    userEvent.click(saveButton);
    await waitFor(() => expect(getByText(/Hello World! 0/)).toBeInTheDocument());
  });
});
